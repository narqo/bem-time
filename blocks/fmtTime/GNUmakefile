MODULE := fmtTime
HEADER := /* This file was AUTOGENERATED! */
MARKER := @@@

inject = echo "$(HEADER)" > $(3);\
	echo $(1) | \
		sed -e "/$(MARKER)/ r $(2)" \
			-e "s/$(MARKER)//g;" \
	>> $(3)

all: $(MODULE).js $(MODULE).bh.js $(MODULE).bemhtml 

%.js: %.src.js
	$(call inject,\
	"modules.define('$(MODULE)', function(provide) {\nprovide($(MODULE));\n$(MARKER)\n\n});",\
	$(<),$(@))

%.bh.js: %.src.js
	$(call inject, \
	"module.exports = function(bh) {\nbh.lib['$(MODULE)'] = $(MODULE);\n$(MARKER)\n\n};", \
	$(<),$(@))

%.bemhtml: %.src.js
	$(call inject, \
	"oninit(function(_, context) {\ncontext.BEMContext.prototype['$(MODULE)'] = $(MODULE);\n$(MARKER)\n\n});", \
	$(<),$(@))
